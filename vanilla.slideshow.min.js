/**
 * Vanilla Slideshow ;) (https://github.com/xylphid)
 * Version 0.1.1
 *
 * @author Anthony PERIQUET
 */
!function(s){var e=null,t={time:null,timeout:!1};s.slideshow=function(n,o){return this instanceof s.slideshow?(this.options=i(s.slideshow.defaults,o),this.autostart=this.options.autostart,this.opened=!1,void("undefined"!=typeof n&&(this.elm=s(n),e=this,s(window).on("resize",function(){e.opened&&(t.time=new Date,t.timeout===!1&&(t.timeout=!0,setTimeout(s.slideshow.resize,200)))}),this.elm.attr("data-single")||s(document).on("click",n,function(e){return e.preventDefault(),s.slideshow.open(e.value)}),s(document).on("keydown",function(t){e&&e.opened&&(27==t.which&&s.slideshow.close(),e.elm.attr("data-single")||37!=t.which||s.slideshow.prev(),e.elm.attr("data-single")||39!=t.which||s.slideshow.next())})))):new s.slideshow(n,o)},s.slideshow.prototype={constructor:s.slideshow,open:function(e){return e instanceof s&&(this.elm=e),this.setOverlay(),this.setModal(),this.showSpinner(),this.show(),this.opened=!0,!1},setOverlay:function(){s(".overlay").remove(),this.overlay=s("<div>").addClass("overlay").css("background",this.options.overlay).css("bottom",0).css("display","none").css("height","100%").css("left",0).css("opacity",this.options.opacity).css("position","fixed").css("right",0).css("top",0).css("width","100%").css("z-index",this.options.zIndex).appendTo("body").fadeIn()},setModal:function(){s(".vanilla-slideshow").remove(),this.modal=s("<div>").addClass("vanilla-slideshow").append(s("<div>").addClass("vanilla-slider")).append(this.getActions()).appendTo("body").swipe("left",function(){s.slideshow.next()}).swipe("right",function(){s.slideshow.prev()}),this.center()},getActions:function(){return actions=s("<div>").addClass("actions").append(s("<a>").addClass("fullscreen").on("click",function(){s.slideshow.fullscreen()})).append(s("<a>").addClass("close").on("click",this.close)),this.elm.attr("data-single")||actions.prepend(s("<a>").addClass("play").on("click",function(){s.slideshow.play()})).prepend(s("<a>").addClass("next").on("click",function(){s.slideshow.next()})).prepend(s("<a>").addClass("prev").on("click",function(){s.slideshow.prev()})),actions},show:function(){this.slide=s("<img>").attr("src",this.elm.attr("href")).addClass("slide").addClass(this.options.scaling).attr("alt","Vanilla Slideshow").load(function(){e.centerSlide(),s(this).appendTo(".vanilla-slideshow > .vanilla-slider").fadeIn(s.slideshow.hideSpinner),s.slideshow.isPlaying()&&s.slideshow.setPlayer(setTimeout(s.slideshow.next,e.options.slideDelay))})},centerSlide:function(){if("fill"==this.options.scaling){scalingH=this.modal.outerHeight()/this.slide.nodes[0].naturalHeight,scalingW=this.modal.outerWidth()/this.slide.nodes[0].naturalWidth;var s=scalingH>scalingW?scalingH:scalingW,e=(this.modal.outerHeight()-this.slide.nodes[0].naturalHeight*s)/2;this.slide.css("transform-origin","0px 0px 0px").css("transform","translate3d(0px, "+e+"px, 0px) scale("+s+")")}},center:function(){this.modal.css("left","50%").css("margin-left",-(this.modal.outerWidth()/2)+"px").css("margin-top",-(this.modal.outerHeight()/2)+"px").css("position","fixed").css("top","50%").css("z-index",this.options.zIndex+1)},resize:function(){new Date-t.time<200?setTimeout(s.slideshow.resize,200):(t.timeout=!1,this.center(),this.centerSlide())},showSpinner:function(){this.working=!0,this.options.showSpinner&&(this.spinner=this.spinner||s("<div>").addClass("spinner"),this.modal.prepend(this.spinner))},hideSpinner:function(){this.spinner&&this.spinner.remove(),this.working=!1},close:function(){e.modal.fadeOut(100),e.overlay.fadeOut(),this.opened=!1},slideOut:function(s){this.showSpinner();var e=this.slide,t="left"==s?-e.outerWidth()-100:e.parent().outerWidth(),i="left"==s?-10:10;e.css("margin-left",e.nodes[0].offsetLeft+"px").css("opacity",0),function n(){var o=(e.css("margin-left")?parseInt(e.css("margin-left")):0)+i;e.css("margin-left",o+"px"),"left"==s&&t>o||"right"==s&&o>t?e.remove():setTimeout(n,1)}()},next:function(){this.options.single||(this.slideOut("left"),next=this.elm.next(),next||(next=this.elm.parent().firstChild()),this.elm=next,this.show())},prev:function(){this.options.single||(this.slideOut("right"),previous=this.elm.prev(),previous||(previous=this.elm.parent().lastChild()),this.elm=previous,this.show())},play:function(){this.options.autostart=!this.options.autostart,this.options.autostart?this.setPlayer(setTimeout(s.slideshow.next,e.options.slideDelay)):clearTimeout(this.player)},isPlaying:function(){return this.options.autostart},setPlayer:function(s){this.player=s},fullscreen:function(){this.isPlaying()&&(this.options.autostart=!this.options.autostart,clearTimeout(this.player)),window.open(this.elm.attr("href"))}},s.slideshow.defaults={autostart:!1,opacity:.75,overlay:"#000",scaling:"fitmax",showSpinner:!0,slideDelay:5e3,zIndex:1},s.slideshow.dispatcher=function(s,t){return e&&"function"==typeof e[t]?(/Event/.test(s)&&s.preventDefault(),e[t](s),e):void 0},s.slideshow.open=function(e){return s.slideshow.dispatcher(e,"open")},s.slideshow.close=function(e){return s.slideshow.dispatcher(e,"close")},s.slideshow.hideSpinner=function(e){return s.slideshow.dispatcher(e,"hideSpinner")},s.slideshow.next=function(e){return s.slideshow.dispatcher(e,"next")},s.slideshow.prev=function(e){return s.slideshow.dispatcher(e,"prev")},s.slideshow.play=function(e){return s.slideshow.dispatcher(e,"play")},s.slideshow.isPlaying=function(){return e?e.isPlaying():void 0},s.slideshow.setPlayer=function(s){e&&e.setPlayer(s)},s.slideshow.fullscreen=function(e){return s.slideshow.dispatcher(e,"fullscreen")},s.slideshow.resize=function(e){s.slideshow.dispatcher(e,"resize")};var i=function(s,e){s="undefined"!=typeof s?s:{};for(var t in e)e[t]&&e[t].constructor&&e[t].constructor===Object?(s[t]=s[t]||{},arguments.callee(s[t],e[t])):s[t]=e[t];return s};s.prototype.slideshow=function(t){return this instanceof s&&(this.attr("data-single","true"),e=new s.slideshow(this,t),s.slideshow.open()),this},s(document).on("click","a[data-slideshow]",function(e){e.preventDefault(),s(e.value).slideshow()})}(vanilla);